<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
        <style>
            .product {
                background-color: white;
                -webkit-box-shadow: 0 0 5px #000;
                -moz-box-shadow: 0 0 5px #000;
                box-shadow: 0 0 5px #000;
                height: 400px;
                margin: 50px;
                margin-left: auto;
                margin-right: auto;
                overflow: hidden;
                width: 75%;
                padding: 50px;
            }
            .product img {
                float: left;
                height: 300px;
                margin-right: 20px;
            }
        </style>
        <title>Look for projects</title>
    </head>
    <body class="cyan lighten-5">
        <nav>
            <div class="nav-wrapper cyan">
                <a href="#" class="brand-logo center">Erbium</a>
            </div>
        </nav>
        <div id="product-container"></div>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>
        <script>
            // Initialize Firebase
            const config = {
                apiKey: "AIzaSyDBzjLVkuyIoqA1CCpPKLEpjZ_XalZaS7A",
                authDomain: "uberforce-v1.firebaseapp.com",
                databaseURL: "https://uberforce-v1.firebaseio.com",
                projectId: "uberforce-v1",
                storageBucket: "uberforce-v1.appspot.com",
                messagingSenderId: "35935706494"
            };
            firebase.initializeApp(config);
        </script>
        <script type="text/javascript">
            // const provider = new firebase.auth.GoogleAuthProvider();
            // firebase.auth().signInWithPopup(provider);
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    firebase.database().ref('/item/').once('value', snapshot => {
                        const products = snapshot.val();
                        const productContainer = document.getElementById('product-container');
                        Object.keys(products).forEach(value => {
                            const product = products[value];
                            const image = document.createElement('img');
                            image.src = product.picture;
                            const name = document.createElement('h2');
                            name.textContent = product.name;
                            const description = document.createElement('p');
                            description.textContent = product.description.substring(0, 180) + (product.description.length > 180 ? '...' : '');
                            const price = document.createElement('h3');
                            price.textContent = '$' + product.cost;
                            const container = document.createElement('div');
                            container.appendChild(image);
                            container.appendChild(name);
                            container.appendChild(description);
                            container.appendChild(price);
                            container.classList.add('product');
                            productContainer.appendChild(container);
                            container.addEventListener('click', e => {
                                window.location = ('/project_details.html?name=' + product.name);
                            });
                        });
                    });
                } else {
                    window.location.redirect("/index.html");
                }
            });
        </script>
    </body>
</html>